{% extends "base.html" %}

{% block title %}Edit Product - MediPlant Admin{% endblock %}

{% block content %}
<div class="admin-content">
    <div class="container-fluid">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-0 text-gray-800">Edit Product</h1>
                <p class="text-muted">Update product information</p>
            </div>
            
            <a href="{{ url_for('admin_products') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Products
            </a>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Product Information</h6>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="name" name="name" 
                                               value="{{ product.name }}" required>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="price" class="form-label">Price (₹) <span class="text-danger">*</span></label>
                                        <input type="number" class="form-control" id="price" name="price" 
                                               step="0.01" value="{{ product.price }}" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="category_id" class="form-label">Category <span class="text-danger">*</span></label>
                                        <select class="form-select" id="category_id" name="category_id" required>
                                            <option value="">Select Category</option>
                                            {% for category in categories %}
                                            <option value="{{ category.id }}" 
                                                    {% if product.category_id == category.id %}selected{% endif %}>
                                                {{ category.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="stock_quantity" class="form-label">Stock Quantity</label>
                                        <input type="number" class="form-control" id="stock_quantity" name="stock_quantity" 
                                               value="{{ product.stock_quantity }}" min="0">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="description" class="form-label">Short Description</label>
                                <textarea class="form-control" id="description" name="description" rows="3">{{ product.description }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="detailed_description" class="form-label">Detailed Description</label>
                                <textarea class="form-control" id="detailed_description" name="detailed_description" rows="5">{{ product.detailed_description }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="benefits" class="form-label">Health Benefits</label>
                                <textarea class="form-control" id="benefits" name="benefits" rows="3">{{ product.benefits }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="usage_instructions" class="form-label">Usage Instructions</label>
                                <textarea class="form-control" id="usage_instructions" name="usage_instructions" rows="3">{{ product.usage_instructions }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="warnings" class="form-label">Warnings & Precautions</label>
                                <textarea class="form-control" id="warnings" name="warnings" rows="3">{{ product.warnings }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="image_url" class="form-label">Image URL</label>
                                <input type="url" class="form-control" id="image_url" name="image_url" 
                                       value="{{ product.image_url }}">
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
                                           {% if product.is_active %}checked{% endif %}>
                                    <label class="form-check-label" for="is_active">
                                        Product is active and visible to customers
                                    </label>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-end gap-2">
                                <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">Cancel</a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Update Product
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <!-- Product Preview -->
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Product Preview</h6>
                    </div>
                    <div class="card-body">
                        <div class="product-preview">
                            <img id="preview-image" src="{{ product.image_url or '/static/images/default-product.jpg' }}" 
                                 alt="Product Preview" class="img-fluid rounded mb-3">
                            
                            <h5 id="preview-name">{{ product.name }}</h5>
                            <p id="preview-price" class="text-success fw-bold">₹{{ "%.2f"|format(product.price) }}</p>
                            <p id="preview-description" class="text-muted">{{ product.description }}</p>
                            
                            <div class="mt-3">
                                <span class="badge bg-light text-dark" id="preview-category">
                                    {% for category in categories %}
                                        {% if category.id == product.category_id %}{{ category.name }}{% endif %}
                                    {% endfor %}
                                </span>
                                <span class="badge bg-info" id="preview-stock">{{ product.stock_quantity }} in stock</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Product Actions -->
                <div class="card shadow">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Quick Actions</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('product_detail', product_id=product.id) }}" 
                               class="btn btn-outline-primary" target="_blank">
                                <i class="fas fa-external-link-alt me-2"></i>View on Site
                            </a>
                            
                            <button class="btn btn-outline-info" onclick="duplicateProduct()">
                                <i class="fas fa-copy me-2"></i>Duplicate Product
                            </button>
                            
                            <button class="btn btn-outline-danger" onclick="deleteProduct()">
                                <i class="fas fa-trash me-2"></i>Delete Product
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Live preview updates
document.getElementById('name').addEventListener('input', function() {
    document.getElementById('preview-name').textContent = this.value || 'Product Name';
});

document.getElementById('price').addEventListener('input', function() {
    document.getElementById('preview-price').textContent = '₹' + (parseFloat(this.value) || 0).toFixed(2);
});

document.getElementById('description').addEventListener('input', function() {
    document.getElementById('preview-description').textContent = this.value || 'Product description...';
});

document.getElementById('image_url').addEventListener('input', function() {
    document.getElementById('preview-image').src = this.value || '/static/images/default-product.jpg';
});

document.getElementById('stock_quantity').addEventListener('input', function() {
    document.getElementById('preview-stock').textContent = (this.value || 0) + ' in stock';
});

document.getElementById('category_id').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    document.getElementById('preview-category').textContent = selectedOption.text !== 'Select Category' ? selectedOption.text : 'No Category';
});

function duplicateProduct() {
    if (confirm('Create a duplicate of this product?')) {
        // Implementation for duplicating product
        alert('Feature coming soon!');
    }
}

function deleteProduct() {
    if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("admin_delete_product", product_id=product.id) }}';
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
